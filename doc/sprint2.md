很好，Sprint 2 是**整个系统“价值感出现的第一个拐点”**。
我会继续严格使用你认可的结构：

> **任务 → 接口 → 页面 → 验收**

并且所有验收标准都围绕一句话：

> **Snapshot 作为权威，这条设计到底对不对？**

---

# Sprint 2 实现清单

**主题：资产快照 & Dashboard v1**
**目标**：把“某一天我真实的资产状态”可靠地记录下来，并一眼看清全局

---

## 🎯 Sprint 2 Goal

> 我可以为任意一天录入资产快照，
> 并在 Dashboard 上**准确看到总资产、流动资产、负债结构**，
> 且我相信这些数字就是“事实”。

---

# T2-1 资产快照（Snapshot）录入

## 任务

实现 **以日期为核心的资产快照录入与查询**，并明确 Snapshot 的权威地位。

---

### 接口

#### POST /api/snapshots/batch_upsert

**用途**：同一日期，多账户一次性录入/覆盖

**请求**

```json
{
  "source": "manual",
  "rows": [
    { "date": "2025-01-05", "account_id": 10, "balance": 6156.16 },
    { "date": "2025-01-05", "account_id": 11, "balance": -4048.06 }
  ]
}
```

**实现规则**

* `(date, account_id)` 唯一
* 同日再次提交 → 覆盖
* 不校验“是否与交易一致”

**响应**

```json
{
  "inserted": 2,
  "updated": 0,
  "warnings": []
}
```

---

#### GET /api/snapshots?date=2025-01-05

**响应**

```json
{
  "date": "2025-01-05",
  "items": [
    { "account_id": 10, "balance": 6156.16 },
    { "account_id": 11, "balance": -4048.06 }
  ]
}
```

---

### 页面

#### 资产快照录入页（核心页面之一）

**交互模型（很重要）**

* 日期选择器（默认今天）
* 表格：

  * 行 = 账户
  * 列 = 余额
* 一次性保存

**行为规则**

* 切换日期 → 重新加载该日快照
* 该日无数据 → 余额列为空
* 输入即覆盖，不弹确认（MVP 简洁优先）

---

### 验收标准

* [x] 同一天可以录入多个账户余额
* [x] 覆盖同日数据不会产生重复
* [x] 不需要任何交易流水就能工作
* [x] 我可以放心地说：**这就是事实，不是推算**

---

# T2-2 Snapshot 查询 & 汇总计算

## 任务

从 Snapshot 中计算**可解释的汇总指标**，供 Dashboard 使用。

---

### 接口

#### GET /api/dashboard/summary?date=2025-01-05

（可直接在 Dashboard Controller 内实现）

**返回口径**

* 总资产 = 所有账户 balance 之和
* 流动资产 = `is_liquid = true` 的账户 balance 之和
* 负债 = `type = credit` 的账户 balance 之和（负数）

**响应**

```json
{
  "date": "2025-01-05",
  "total_assets": 1506755.38,
  "liquid_assets": 1057587.35,
  "liabilities": -4048.06,
  "by_type": {
    "cash": 16669.30,
    "debit": 6158.76,
    "credit": -4048.06,
    "investment_cash": 1038807.35,
    "other": 1516.79
  }
}
```

---

### 页面

#### Dashboard v1（快照视角）

**核心模块**

1. 日期选择（与 Snapshot 页一致）
2. 指标卡片

   * 总资产
   * 流动资产
   * 负债
3. 资产结构

   * 按账户类型分组（简单列表或饼图）

**交互规则**

* 切换日期 → 所有指标联动更新
* 无 Snapshot 数据 → 明确提示“该日无记录”

---

### 验收标准

* [ ] Dashboard 数字 = Snapshot 直接汇总
* [ ] 不依赖任何估值/交易
* [ ] 任意日期都可回看
* [ ] 数值“看起来就是我 Excel 里的那一行”

---

# T2-3 Snapshot 权威性验证（为后续铺路）

## 任务

建立 **Snapshot 与 Transaction 的“对账框架”**（先不真正计算）。

---

### 接口（占位）

#### GET /api/reconciliation/warnings?date=2025-01-05

**当前阶段返回**

```json
{
  "items": [],
  "note": "交易流水尚未启用，对账将在 Sprint 6 开始"
}
```

---

### 页面

#### Dashboard 轻提示（非阻断）

* 区域：Dashboard 底部或角落
* 文案：

  > “当前资产数据来源于资产快照，交易对账将在后续版本启用”

---

### 验收标准

* [ ] Snapshot 不被任何逻辑“纠正”
* [ ] 对账逻辑明确是“提示型”
* [ ] 用户不会误以为系统在自动算资产

---

# T2-4 前后端联调 & 使用验证

## 任务

确保 Snapshot → Dashboard 的闭环真实可用。

---

### 联调清单

* [ ] 新建账户 → 出现在 Snapshot 表格
* [ ] 录入 Snapshot → Dashboard 实时变化
* [ ] 改某账户余额 → 总资产同步变化
* [ ] 切换日期 → 所有数据跟随

---

### Sprint 2 Exit Criteria（完成标准）

> 只有当你能**不用 Excel**，
> 仅靠系统完成下面这件事，Sprint 2 才算完成：

* [ ] 我能为某一天录入全部资产
* [ ] 我能一眼看到当天的资产全貌
* [ ] 我相信这些数是“事实”，不是“算出来的”

---

## 🧠 Sprint 2 的产品价值总结（给未来的你）

> **到 Sprint 2 结束，你已经拥有一个“可靠的个人资产台账”。**

哪怕后面什么都不做：

* 不算收益
* 不算 XIRR
* 不做预测

这个系统也已经**超过 90% 的记账工具**。

---

如果你愿意，下一步我可以：

* **继续按同样粒度写 Sprint 3（产品估值 & 可比性）**
* 或 **把 Sprint 2 的页面线框用文字精确描述（组件级）**

你选一个，我继续。
